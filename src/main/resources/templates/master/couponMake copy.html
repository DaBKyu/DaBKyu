<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쿠폰생성페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" >
    <link rel="stylesheet" href="../../static/css/master.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" ></script>
    <style>
        .selected-tag {
            display: inline-block;
            background-color: #e9ecef;
            padding: 0.25rem 0.5rem;
            margin: 0.25rem;
            border-radius: 0.25rem;
        }
        .selected-tag .close {
            margin-left: 0.5rem;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <!-- 네비게이션 바 -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
          <a class="navbar-brand" href="#">Admin</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                  <li class="nav-item dropdown"><a class="nav-link dropdown-toggle active" href="#" data-bs-toggle="dropdown" aria-expanded="false">상품관리</a>
                      <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="../master/productManage.html">상품관리</a></li>
                          <li><a class="dropdown-item" href="../master/categoryManage.html">카테고리 관리</a></li>
                          <li><a class="dropdown-item" href="../master/productUpload.html">상품 등록</a></li>
                        </ul>
                  </li>
                  <li class="nav-item"><a class="nav-link" href="../master/userManage.html">회원관리</a></li>
                  <li class="nav-item"><a class="nav-link" href="../master/deliveryManage.html">배송관리</a></li>
                  <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">문의/리뷰목록</a>
                      <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="../master/qnaList.html">문의 목록</a></li>
                          <li><a class="dropdown-item" href="../master/reviewList.html">리뷰 목록</a></li>
                        </ul>
                  </li>
                  <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">메일관리</a>
                      <ul class="dropdown-menu">
                          <li><a class="dropdown-item" href="../master/mailList.html">메일 발송 목록</a></li>
                          <li><a class="dropdown-item" href="../master/mailSend.html">메일 발송</a></li>
                        </ul>
                  </li>
                  <li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown" aria-expanded="false">쿠폰</a>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="../master/couponMake.html">쿠폰 생성</a></li>
                      <li><a class="dropdown-item" href="../master/couponList.html">생성된 쿠폰 리스트</a></li>
                    </ul>
                  </li>
              </ul>
              <span class="navbar-text">Admin01</span>
          </div>
      </div>
    </nav>

  <div class="container mt-3">
    <div class="d-flex justify-content-between">
      <div class="p-2"><a href="couponMake.html" class="headtext">쿠폰생성</a></div>
      <div class="p-2"><a href="couponList.html" class="headtext">생성된 쿠폰 리스트</a></div>
      <div class="p-2"></div>
    </div>
    <hr>

    <div class="row">
      <div class="col-lg-6 col-md-12 mb-4">

        <!-- 쿠폰 적용범위-->
        <!-- 1.전체적용이나 카테고리 선택하여 설정 -->
        <!-- 카테고리는 메인>중간>세부카테고리 구조 -->
        <div class="mb-3">
            <label for="" class="form-label" style="display: inline-block;">쿠폰 적용 범위</label>
            <div class="input-group mb-3" >
              <div class="dropdown" id="categoryContainer">
                <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"></button>
                <ul class="dropdown-menu" id="mainCategoryList">
                  <li th:each="category : ${categories}" th:text="${category.name}" th:data-id="${category.id}" class="dropdown-item">카테고리 이름</li>
                  <li data-id="1">전자제품</li>
                  <li data-id="2">의류</li>
                  <li data-id="3">가구</li>
                </ul>

                <!-- 중간 카테고리 -->
                <ul class="category-list subcategory" id="midCategoryList"></ul>

                <!-- 세부 카테고리 -->
                <ul class="category-list subsubcategory" id="subCategoryList"></ul>
              </div>
              <input type="text" class="form-control" aria-label="Text input with dropdown button" placeholder="모든상품">
            </div>
        </div>

        <!-- 2.상품을 검색하여 쿠폰 적용범위에 추가 -->
        <div class="mb-3">
          <label for="productSearch" class="form-label">상품 검색</label>
          <div class="input-group mb-1">
            <input type="text" class="form-control" placeholder="" aria-label="productSearch" aria-describedby="button-addon2">
            <button class="btn btn-outline-secondary" type="button" id="button-addon2">검색</button>
          </div>
        </div>




        <!-- 선택된 카테고리 -->
        <div class="mb-3">
          <label for="Category" class="form-label">카테고리</label>
          <div id="categorytag" class="border p-2 rounded">
              <!-- 예시 태그 -->
              <span class="category-tag">Laptop<span class="close">&times;</span></span>
          </div>
        </div>

        <!-- 선택된 중간카테고리 -->
        <div class="mb-3">
          <label for="midCategory" class="form-label">중간 카테고리</label>
          <div id="categorytag" class="border p-2 rounded">
              <!-- 예시 태그 -->
              <span class="category-tag">AI Laptop<span class="close">&times;</span></span>
          </div>
        </div>

        <!-- 선택된 세부카테고리 -->
        <div class="mb-3">
          <label for="midCategory" class="form-label">세부 카테고리</label>
          <div id="categorytag" class="border p-2 rounded">
              <!-- 예시 태그 -->
              <span class="category-tag">Dell<span class="close">&times;</span></span>
          </div>
        </div>

        <!-- 선택된 상품 -->
        <div class="mb-3">
          <label for="selectedProduct" class="form-label">선택된 상품</label>
          <div id="producttag" class="border p-2 rounded">
            <!-- 예시 태그 -->
            <span class="category-tag">Dell xps13<span class="close">&times;</span></span>
          </div>
        </div>

      </div>

      <div class="col-lg-6 col-md-12 mb-4">

        <!-- 사용 혜택 -->
        <div class="mb-3 row">
          <label for="" class="form-label">사용 혜택</label>
          <div class="col-2 w-auto">
            <select class="form-select " aria-label="혜택 옵션 선택">
              <option selected>옵션</option>
              <option value="1">금액 할인</option>
              <option value="2">비율 할인</option>
            </select>
          </div>
          <div class="col-6 w-50"><input type="text" class="form-control"></div> 
          <div class="col-3 w-auto">
            <select class="form-select" aria-label="옵션 내용 설정">
              <option selected>화폐설정</option>
              <option value="1">KRW</option>
              <option value="2">USD</option>
              <option value="3">CNY</option>
              <option value="4">%</option>
            </select>
          </div>
        </div>

        <!-- 사용 기간 -->
        <div class="mb-4 row">
          <label for="" class="form-label">사용 기간</label>
          <div class="col-5"><input type="datetime-local" id="coupon_start_date" class="form-control"></div>
          ~
          <div class="col-5"><input type="datetime-local" id="coupon_end_date" class="form-control"></div>
        </div>

        <div class="mb-3">
          <label for="" class="form-label">사용 옵션</label>&emsp;
          <div class="form-check" style="display: inline-block;">
            <input class="form-check-input" type="checkbox" value="" id="isDupl">
            <label class="form-check-label" for="flexCheckDefault">
              추가 할인 가능
            </label>
          </div>
        </div>


        <!-- 권한 설정 -->
        <div class="">
          <label for="" class="form-label">권한 설정</label> &emsp;
          <select id="coupon_role" class="form-select mb-3 w-auto" style="display: inline-block;">
            <option>플래티넘</option>
            <option>골드</option>
            <option>실버</option>
            <option>브론즈</option>
          </select><br><br><br><br>

          <label for="" class="form-label">쿠폰명</label> &emsp;
          <input type="text" id="couponName" placeholder='쿠폰명 입력' class='form-control w-50' style="display: inline-block;">
        </div>

      </div> 
    </div><hr>

    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
      <button type='submit' class='btn btn-primary'>생성</button>
    </div>

  </div>
  <script>
    // 카테고리 데이터 (서버에서 받아온다고 가정)
    const categories = {
        1: { name: "전자제품", subcategories: { 
                11: { name: "노트북", subcategories: { 111: "게이밍 노트북", 112: "울트라북" } },
                12: { name: "스마트폰", subcategories: { 121: "안드로이드", 122: "iOS" } }
            }
        },
        2: { name: "의류", subcategories: { 
                21: { name: "남성 의류", subcategories: { 211: "셔츠", 212: "바지" } },
                22: { name: "여성 의류", subcategories: { 221: "원피스", 222: "블라우스" } }
            }
        },
        3: { name: "가구", subcategories: { 
                31: { name: "침실 가구", subcategories: { 311: "침대", 312: "옷장" } },
                32: { name: "거실 가구", subcategories: { 321: "소파", 322: "책장" } }
            }
        }
    };
    let hideTimeout;
    
    // 메인 카테고리에 마우스를 올리면 중간 카테고리가 표시되고, 마우스를 벗어나면 숨김
    document.getElementById('mainCategoryList').addEventListener('mouseover', function(event) {
        const mainCategoryId = event.target.getAttribute('data-id');
        
        if (mainCategoryId) {
            clearTimeout(hideTimeout); // 타이머 초기화
            const midCategoryList = document.getElementById('midCategoryList');
            midCategoryList.innerHTML = ''; // 초기화
            midCategoryList.style.display = 'block';
    
            const midCategories = categories[mainCategoryId].subcategories;
    
            for (const midCatId in midCategories) {
                const li = document.createElement('li');
                li.textContent = midCategories[midCatId].name;
                li.setAttribute('data-id', midCatId);
                
                // 중간 카테고리에 마우스를 올리면 세부 카테고리가 표시되고, 마우스를 벗어나면 숨김
                li.addEventListener('mouseover', function() {
                    clearTimeout(hideTimeout); // 타이머 초기화
                    const subCategoryList = document.getElementById('subCategoryList');
                    subCategoryList.innerHTML = ''; // 초기화
                    subCategoryList.style.display = 'block';
    
                    const subCategories = midCategories[midCatId].subcategories;
    
                    for (const subCatId in subCategories) {
                        const subLi = document.createElement('li');
                        subLi.textContent = subCategories[subCatId];
                        subLi.setAttribute('data-id', subCatId);
    
                        // 세부 카테고리를 클릭하면 태그로 저장
                        subLi.addEventListener('click', function() {
                            addTag(categories[mainCategoryId].name + ' > ' + midCategories[midCatId].name + ' > ' + subCategories[subCatId]);
                        });
    
                        subCategoryList.appendChild(subLi);
                    }
                });
    
                midCategoryList.appendChild(li);
            }
        }
    });
    
    // 마우스가 전체 컨테이너를 벗어났을 때 하위 카테고리를 숨김
    document.getElementById('categoryContainer').addEventListener('mouseleave', function() {
        hideTimeout = setTimeout(function() {
            document.getElementById('midCategoryList').style.display = 'none';
            document.getElementById('subCategoryList').style.display = 'none';
        }, 30); // 딜레이 추가 (300ms)
    });
    
    // 선택된 카테고리를 태그로 표시하는 함수
    function addTag(categoryPath) {
        const selectedTagsDiv = document.getElementById('selectedTags');
        
        const tag = document.createElement('span');
        tag.className = 'selected-tag';
        
        // 태그에 X 버튼 추가
        tag.innerHTML = categoryPath + '<span class="close">&times;</span>';
        
        // X 버튼 클릭 시 해당 태그 삭제
        tag.querySelector('.close').addEventListener('click', function() {
            selectedTagsDiv.removeChild(tag);
        });
    
        selectedTagsDiv.appendChild(tag);
    }
    </script>
</body>
</html>